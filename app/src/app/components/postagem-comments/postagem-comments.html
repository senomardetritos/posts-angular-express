<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<!-- eslint-disable @angular-eslint/template/interactive-supports-focus -->
<div class="comments">
  <i class="bi bi-chat" (click)="modalComments()"></i>
  <p class="link" (click)="modalComments()">{{ comments() }}</p>
  <p class="link" (click)="modalComments()">Comentário(s)</p>
  <app-modal [show]="showComments()" class="modal">
    <div class="row modal-header">
      <div class="col">
        <h1><span class="text-gradient">Comentários</span></h1>
      </div>
      <div class="col right">
        <i class="bi bi-x" (click)="modalComments()"></i>
      </div>
    </div>
    <div class="divider"></div>
    <div class="row modal-form input-submit-icon">
      <form [formGroup]="formComment" (submit)="onSubmit()">
        <div class="form-control">
          <input
            formControlName="comment"
            type="text"
            id="comment"
            placeholder="Digite um comentário"
            autocomplete="off"
          />
          @if (formComment.get('comment')?.touched &&
          formComment.get('comment')?.errors?.['required']) {
          <div class="error">Comentário é requerido.</div>
          } @else if (formComment.get('comment')?.errors?.['minlength']) {
          <div class="error">Comentário tem que ter mais de 6 caracteres.</div>
          }
        </div>
        <button type="submit"><i class="bi bi-send"></i></button>
      </form>
    </div>
    <div class="divider"></div>
    @if (list_comments().length > 0) {
    <div class="modal-items">
      @for (comment of list_comments(); track comment.id) {
      <div class="row">
        <div class="col auto">
          <div
            class="user-photo-rounded medium pointer"
            routerLink="/user/{{ comment.user.id }}"
          >
            <img
              [src]="img_url + comment.user.id + '?date=' + now"
              alt="Foto de Perfil"
            />
          </div>
        </div>
        <div class="col">
          <div class="comment">
            <span
              class="user pointer"
              routerLink="/user/{{ comment.user.id }}"
              >{{ comment.user.name }}</span
            >
            <span>{{ comment.comment }}</span>
          </div>

          <div class="modal-items-footer">
            @if (comment.date) {
            <div class="comment-date">
              {{ comment.date | date : "dd/MM/yyyy - HH:mm" }}
            </div>
            <div>
              @if (comment.user.email === user.email) {
              <a (click)="deleteComment(comment.id)">Excluir</a>
              }
            </div>
            } @else {
            <div class="comment-date">Publicando comentário</div>
            }
          </div>
        </div>
      </div>
      <div class="divider"></div>
      }
    </div>
    } @else {
    <div class="modal-items">
      <div class="col">
        <p>Nenhuma comentário ainda...</p>
      </div>
    </div>
    }
  </app-modal>
</div>
